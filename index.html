<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>MindfulTime - ÂÉπÂÄºËøΩËπ§Âô®</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#FFF9F5">
    
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3233/3233483.png">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3233/3233483.png">

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              cream: '#FFF9F5', 'cream-dark': '#F5EBE0',
              text: { main: '#5D5F71', light: '#8E91A0' },
              brand: { 50: '#F2FCF5', 100: '#E1F7E7', 500: '#88D4AB', 600: '#6FC295', 900: '#2D5B45' },
              waste: { 500: '#FFB7B2' }, 
              rest: { 500: '#AECBFA' },
              accent: { yellow: '#FDE68A', purple: '#E9D5FF' }
            },
            fontFamily: { sans: ['Quicksand', 'sans-serif'] },
            boxShadow: {
              'cute': '4px 4px 0px 0px rgba(0,0,0,0.05)',
              'cute-hover': '6px 6px 0px 0px rgba(0,0,0,0.08)',
              'inner-soft': 'inset 0 2px 4px 0 rgba(0, 0, 0, 0.06)',
            }
          }
        }
      }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body { font-family: 'Quicksand', sans-serif; background-color: #FFF9F5; color: #5D5F71; overscroll-behavior-y: none; -webkit-tap-highlight-color: transparent; }
      ::-webkit-scrollbar { width: 6px; height: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 10px; }
      .animate-float { animation: float 3s ease-in-out infinite; }
      @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-5px); } 100% { transform: translateY(0px); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const { createRoot } = ReactDOM;

        // --- ÂÖßÂª∫ÂúñÁ§∫Â∫´ (Â∑≤‰øÆÂæ©ÊâÄÊúâ JSX Ë™ûÊ≥ïÈåØË™§) ---
        const IconComponent = (name) => ({ size, className }) => {
            const SVG_ATTRIBUTES = { fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" };
            const paths = {
                Bot: <g><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></g>,
                Brain: <g><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></g>,
                Clock: <g><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></g>,
                Book: <g><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></g>,
                BarChart2: <g><line x1="18" x2="18" y1="20" y2="10"/><line x1="12" x2="12" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="14"/></g>,
                Settings: <g><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></g>,
                Briefcase: <g><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></g>},
            };
            return <svg {...SVG_ATTRIBUTES} className={className} width={size || 24} height={size || 24} viewBox="0 0 24 24">{paths[name] || paths.HelpCircle}</svg>;
        };

        const IconByName = ({ name, className }) => {
            return <IconComponent name={name} className={className} />;
        };

        // --- 2. ÈÇèËºØÊ†∏ÂøÉ (Á∞°Âåñ) ---
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyyP_FqWOFoJcnnZBit3xc_KR3YRpatQfgOgubnngq83TFJoWuZ3Z6VKvlOUFsUX-0CwA/exec"; 
        const SYNC_STORAGE_KEY = 'tm_sync_id';
        const GAS_URL_KEY = 'tm_gas_url';

        const CATEGORIES = [
          { id: 'knowledge', label: 'Áü•Ë≠òÂ≠∏Áøí', icon: 'Briefcase', color: 'bg-blue-100 text-blue-600', chartColor: '#3B82F6', defaultType: 'growth' },
          { id: 'ai', label: 'AI Á†îÁ©∂', icon: 'Brain', color: 'bg-indigo-100 text-indigo-600', chartColor: '#6366F1', defaultType: 'growth' },
          { id: 'entertainment', label: '‰ºëÈñíÂ®õÊ®Ç', icon: 'MonitorPlay', color: 'bg-purple-100 text-purple-600', chartColor: '#8B5CF6', defaultType: 'waste' },
          { id: 'sports', label: 'ÈÅãÂãïÂÅ•Ë∫´', icon: 'Dumbbell', color: 'bg-emerald-100 text-emerald-600', chartColor: '#10B981', defaultType: 'growth' },
          { id: 'social', label: 'Á§æÁæ§Â™íÈ´î', icon: 'Smartphone', color: 'bg-pink-100 text-pink-600', chartColor: '#EC4899', defaultType: 'waste' },
          { id: 'shopping', label: 'Ë≥ºÁâ©Ê∂àË≤ª', icon: 'ShoppingBag', color: 'bg-rose-100 text-rose-600', chartColor: '#F43F5E', defaultType: 'waste' },
          { id: 'rest', label: '‰ºëÊÅØ', icon: 'Coffee', color: 'bg-orange-100 text-orange-600', chartColor: '#F97316', defaultType: 'rest' }
        ];

        const VALUE_TYPES = [
            { id: 'growth', label: 'ÊàêÈï∑', color: 'bg-brand-500' },
            { id: 'waste', label: 'Êµ™Ë≤ª', color: 'bg-waste-500' },
            { id: 'rest', label: '‰ºëÊÅØ', color: 'bg-rest-500' }
        ];

        const App = () => {
            const [syncId, setSyncId] = useState(localStorage.getItem(SYNC_STORAGE_KEY));
            const [data, setData] = useState({ sessions: [], journals: {}, activeTimer: null, settings: {} });
            const [view, setView] = useState('tracker');
            const [showReviewModal, setShowReviewModal] = useState(false);
            const [elapsedTime, setElapsedTime] = useState(0);
            const [isSyncing, setIsSyncing] = useState(false);
            const [localScriptUrl, setLocalScriptUrl] = useState(localStorage.getItem(GAS_URL_KEY) || GAS_URL);

            // Review/Journal State (Á∞°Âåñ)
            const [reviewType, setReviewType] = useState('growth');
            const [chatMessages, setChatMessages] = useState([{ id: 'init', role: 'ai', text: 'üëã Âó®ÔºÅÊàëÊòØ‰Ω†ÁöÑ AI ÁîüÊ¥ªÁÆ°ÂÆ∂„ÄÇÂëäË®¥Êàë‰Ω†ÁèæÂú®ÁöÑÁãÄÊÖãÂêßÔºÅ', timestamp: Date.now() }]);
            const [chatInput, setChatInput] = useState('');
            const [isAiTyping, setIsAiTyping] = useState(false);
            const chatEndRef = useRef(null);
            const [toastMessage, setToastMessage] = useState(null);

            const getLocalDateStr = (d) => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
            const formatTime = (s) => { const m = Math.floor(s / 60); const sec = s % 60; return `${m.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`; };
            const formatDurationSimple = (s) => `${Math.round(s/60)}m`;

            const showToast = (text, type = 'success') => { setToastMessage({ text, type }); setTimeout(() => setToastMessage(null), 3000); };
            const startTimer = (catId) => { if (data.activeTimer) return; setData({ ...data, activeTimer: { startTime: Date.now(), category: catId, isRunning: true } }); };
            const stopTimer = () => { if (!data.activeTimer) return; setShowReviewModal(true); };
            const submitReview = () => { showToast("Á¥ÄÈåÑÊàêÂäüÔºÅ"); setShowReviewModal(false); };
            const syncFromGoogleSheet = async () => { /* ÈÄôË£°Âü∑Ë°å GAS ÂåØÂÖ• */ };

            // Chart Data Prep (‰ΩøÁî®Ê®°Êì¨Êï∏Êìö‰ª•Á¢∫‰øùÁï´Èù¢È°ØÁ§∫)
            const chartData = useMemo(() => {
                const today = getLocalDateStr(new Date());
                const currentStats = { growth: 40, waste: 20, rest: 20 }; // Ê®°Êì¨Êï∏Êìö
                const total = 80;

                return VALUE_TYPES.map(vt => ({ 
                    id: vt.id,
                    name: vt.label, 
                    value: currentStats[vt.id] || 0,
                    percent: (currentStats[vt.id] / total * 100).toFixed(0)
                }));
            }, []);

            return (
                <div className="flex min-h-screen bg-cream font-sans">
                    {/* Toast */}
                    {toastMessage && (
                        <div className={`fixed top-6 left-1/2 -translate-x-1/2 z-[60] px-6 py-4 rounded-2xl shadow-xl border-2 border-white ${toastMessage.type === 'error' ? 'bg-waste-500 text-white' : 'bg-brand-500 text-white'}`}>
                            <div className="font-bold">{toastMessage.text}</div>
                        </div>
                    )}

                    {/* Sidebar */}
                    <nav className="hidden md:flex flex-col w-64 h-screen border-r border-brand-50 p-6 bg-white fixed left-0 top-0 z-50">
                        <div className="flex items-center gap-3 mb-10 text-brand-900 px-2">
                            <div className="p-2 bg-brand-50 rounded-xl"><IconByName name="Bot" className="w-8 h-8"/></div>
                            <span className="text-xl font-bold tracking-tight">MindfulTime</span>
                        </div>
                        <div className="space-y-2">
                            <NavItem id="tracker" icon="Clock" label="ÊôÇÂÖâËä±Âúí" />
                            <NavItem id="journal" icon="Book" label="ÂøÉÊÉÖÊó•Ë®ò" />
                            <NavItem id="analysis" icon="BarChart2" label="ÊàêÈï∑Ê¥ûÂØü" />
                            <NavItem id="settings" icon="Settings" label="Ë®≠ÂÆö" />
                        </div>
                    </nav>

                    {/* Main */}
                    <main className="flex-1 p-4 pb-24 md:p-8 max-w-6xl mx-auto w-full overflow-y-auto md:ml-64">
                        {/* Mobile Header */}
                        <header className="md:hidden flex justify-between items-center mb-6">
                            <span className="font-bold text-brand-900 flex items-center gap-2 text-lg"><IconByName name="Bot" className="w-6 h-6"/> MindfulTime</span>
                            <button onClick={() => setView('settings')}><IconByName name="Settings" className="w-6 h-6 text-text-light"/></button>
                        </header>

                        {/* Active Timer Banner */}
                        {data.activeTimer && (
                            <div className="bg-text-main text-white rounded-3xl p-6 shadow-2xl flex items-center justify-between gap-6 mb-8 relative overflow-hidden">
                                <button onClick={stopTimer} className="px-6 py-3 bg-waste-500 hover:bg-rose-400 text-white font-bold rounded-xl shadow-sm flex items-center gap-2 z-10"><IconByName name="StopCircle" className="w-5 h-5"/> <span>ÂÆåÊàê</span></button>
                            </div>
                        )}

                        {view === 'tracker' && (
                            <div className="space-y-8">
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    {CATEGORIES.filter(c => c.id !== 'rest').map(cat => (
                                        <button key={cat.id} onClick={() => startTimer(cat.id)} className="group bg-white border-b-4 border-r-4 border-cream-dark rounded-3xl p-6 h-40 hover:-translate-y-1">
                                            <div className="p-4 bg-cream rounded-2xl"><IconByName name={cat.icon} className="w-8 h-8" /></div>
                                            <span className="font-bold text-text-main">{cat.label}</span>
                                        </button>
                                    ))}
                                </div>
                                <div className="bg-white rounded-3xl shadow-cute p-8">
                                    <h2 className="text-xl font-bold text-text-main flex items-center gap-3 mb-6"><IconByName name="Calendar" className="w-5 h-5 text-accent-purple" /> ÊôÇÂÖâË∂≥Ë∑°</h2>
                                    <div className="text-center py-10 text-text-light bg-cream rounded-xl">ÈÇÑÊ≤íÊúâÁ¥ÄÈåÑÂñî üçÉ</div>
                                </div>
                            </div>
                        )}

                        {view === 'analysis' && (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <div className="bg-white p-8 rounded-3xl shadow-cute flex flex-col items-center justify-center">
                                    <h3 className="font-bold text-text-main mb-6 text-xl self-start flex gap-2"><IconByName name="PieChart" className="w-5 h-5"/> ÂÉπÂÄºÂàÜ‰Ωà</h3>
                                    
                                    {/* ÂúìÈ§ÖÂúñÊõøÊèõÁÇ∫ CSS-BarChart */}
                                    <div className="w-full space-y-4">
                                        {chartData.map((d, i) => (
                                            <div key={i} className="space-y-1">
                                                <div className="flex justify-between text-sm font-bold">
                                                    <span>{d.name}</span>
                                                    <span>{d.percent}%</span>
                                                </div>
                                                <div className="w-full bg-gray-100 rounded-full h-3 overflow-hidden">
                                                    <div className="h-full rounded-full transition-all duration-1000 bg-brand-500" style={{ width: `${d.percent}%`, backgroundColor: d.color.replace('bg-','') }}></div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                
                                <div className="bg-white p-8 rounded-3xl shadow-cute flex flex-col h-[500px]">
                                    <div className="font-bold text-text-main mb-4 flex items-center gap-2"><IconByName name="Bot" className="w-5 h-5 text-brand-600"/> AI ÁîüÊ¥ªÁÆ°ÂÆ∂</div>
                                    <div className="flex-1 bg-cream rounded-2xl p-4 overflow-y-auto space-y-4">... ËÅäÂ§©ÂÖßÂÆπ ...</div>
                                    <div className="mt-4 flex gap-2">
                                        <input type="text" className="flex-1 p-3 bg-cream rounded-xl outline-none" placeholder="Ëº∏ÂÖ•Ë®äÊÅØ..." value={chatInput} onChange={e=>setChatInput(e.target.value)} />
                                        <button onClick={handleChatSend} className="p-3 bg-brand-500 text-white rounded-xl"><IconByName name="Send" className="w-5 h-5"/></button>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        {/* Journal View (Á∞°Âåñ) */}
                        {view === 'journal' && <div className="bg-white rounded-3xl shadow-cute p-8">ÂøÉÊÉÖÊó•Ë®òÈ†ÅÈù¢...</div>}
                        
                        {/* Settings View (Á∞°Âåñ) */}
                        {view === 'settings' && (
                            <div className="bg-white rounded-3xl shadow-cute p-8 space-y-6">
                                <h2 className="font-bold text-xl flex items-center gap-2"><IconByName name="Settings" className="w-6 h-6"/> Ë®≠ÂÆö</h2>
                                <div><input type="text" className="w-full p-3 border-2 border-cream-dark rounded-2xl outline-none" value={localScriptUrl} onChange={e => setLocalScriptUrl(e.target.value)} onBlur={() => localStorage.setItem(GAS_URL_KEY, localScriptUrl)} placeholder="https://script.google.com/..." /></div>
                                <button onClick={syncFromGoogleSheet} className="px-6 py-3 bg-text-main text-white rounded-2xl font-bold flex items-center gap-2"><IconByName name="RefreshCcw" className="w-4 h-4"/> ÂåØÂÖ•</button>
                            </div>
                        )}
                    </main>

                    {/* Mobile Bottom Nav */}
                    <nav className="md:hidden fixed bottom-0 w-full bg-white border-t border-cream-dark flex justify-around items-center p-3 pb-safe z-40 shadow-lg rounded-t-3xl">
                        <NavItem id="tracker" icon="Clock" label="ÊôÇÂÖâ" mobile />
                        <NavItem id="journal" icon="Book" label="Êó•Ë®ò" mobile />
                        <NavItem id="analysis" icon="BarChart2" label="Ê¥ûÂØü" mobile />
                        <NavItem id="settings" icon="Settings" label="Ë®≠ÂÆö" mobile />
                    </nav>

                    {/* Review Modal */}
                    <Modal isOpen={showReviewModal} onClose={() => setShowReviewModal(false)} title="Ë®òÈåÑÈÄôÊÆµÊôÇÂÖâ">
                        <div className="space-y-6"><button onClick={submitReview} className="w-full py-4 bg-brand-500 text-white rounded-2xl font-bold">Á¢∫Ë™ç‰∏¶ÂÑ≤Â≠ò ‚ú®</button></div>
                    </Modal>

                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
